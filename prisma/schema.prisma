// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Project {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  icon        String     @default("folder") // lucide icon name
  color       String     @default("blue")   // tailwind color name
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  endpoints   Endpoint[]
}

model Endpoint {
  id           String   @id @default(cuid())
  projectId    String
  project      Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  // Metadata
  title        String
  path         String
  method       String
  moduleName   String?
  businessDesc String?
  security     String?  // "secure" | "open"
  roles        Json?    // ["admin","user","instructor"] 

  // Prompt persona
  personaMode  String?  // "auto" | "manual"
  personaKey   String?  // "staff" | "senior" | "security" | "api-designer"

  // Specs
  requestSpec     Json? // Body
  requestQuery    Json? // Query Params
  requestHeaders  Json? // Headers
  responseSpec    Json?

  // Prompt preferences
  promptPrefs  Json?    // { cleanCode, bestPractice, noExtraComments, unitTests, apiTests }
  techNotes    String?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model User {
  id        String   @id @default(cuid())
  name      String
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
